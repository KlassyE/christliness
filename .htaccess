<IfModule mod_rewrite.c>
    RewriteEngine On
    RewriteBase /

    # 1. FORCE the server to serve dist/index.html when asking for the root directory
    DirectoryIndex dist/index.html

    # 2. Redirect explicit requests for the source index.html to the dist version
    RewriteRule ^index\.html$ dist/index.html [L]

    # 3. Rewrite asset requests (e.g. /assets/foo.js) to /dist/assets/foo.js
    RewriteRule ^assets/(.*)$ dist/assets/$1 [L,QSA]

    # 4. Standard Fallback/SPA Rule
    # If the file exists (and is NOT the source index.html), serve it.
    RewriteCond %{REQUEST_URI} !^/index\.html$
    RewriteCond %{REQUEST_URI} !^/src/
    RewriteCond %{REQUEST_FILENAME} -f [OR]
    RewriteCond %{REQUEST_FILENAME} -d
    RewriteRule ^ - [L]

    # 5. Otherwise, serve dist/index.html (for React Router)
    # Exclude /dist/ to prevent infinite loops
    RewriteCond %{REQUEST_URI} !^/dist/
    RewriteRule ^ dist/index.html [L]
</IfModule>
